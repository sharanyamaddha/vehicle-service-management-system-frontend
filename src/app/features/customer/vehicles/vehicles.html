<div class="content-card">
    <div class="card-header">
        <h3>My Vehicles</h3>
        <button class="btn-primary" (click)="openAddVehicleModal()">
            <svg class="btn-icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Add New Vehicle
        </button>
    </div>


    <div class="modal-backdrop" *ngIf="showAddVehicle">
        <div class="modal-content">
            <h3>Add New Vehicle</h3>
            <form [formGroup]="vehicleForm" (ngSubmit)="submitVehicle()">
                <div class="form-grid">


                    <div class="form-group full-width">
                        <label>Registration Number</label>
                        <input type="text" formControlName="registrationNumber" class="form-control"
                            placeholder="e.g. KA01AB1234">
                        <div *ngIf="vehicleForm.get('registrationNumber')?.touched && vehicleForm.get('registrationNumber')?.invalid"
                            class="text-danger small mt-1">
                            <div *ngIf="vehicleForm.get('registrationNumber')?.errors?.['required']">Registration Number
                                is required.</div>
                            <div *ngIf="vehicleForm.get('registrationNumber')?.errors?.['pattern']">Format must be like
                                MH12AB1234.</div>
                            <div *ngIf="vehicleForm.get('registrationNumber')?.errors?.['duplicate']">This registration
                                number is already registered.</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Brand</label>
                        <input type="text" formControlName="make" class="form-control" placeholder="e.g. Toyota">
                    </div>

                    <div class="form-group">
                        <label>Model</label>
                        <input type="text" formControlName="model" class="form-control" placeholder="e.g. Camry">
                    </div>

                    <div class="form-group">
                        <label>Date of Manufacture (Year)</label>
                        <input type="number" formControlName="year" class="form-control">
                    </div>

                    <div class="form-group">
                        <label>Vehicle Type</label>
                        <select formControlName="type" class="form-select">
                            <option value="CAR">Car</option>
                            <option value="BIKE">Bike</option>
                            <option value="SCOOTY">Scooty</option>
                            <option value="TRUCK">Truck</option>
                            <option value="BUS">Bus</option>
                            <option value="VAN">Van</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Color</label>
                        <input type="text" formControlName="color" class="form-control" placeholder="e.g. Red">
                    </div>

                    <div class="form-group full-width">
                        <label>Description (Optional)</label>
                        <textarea formControlName="description" class="form-control" rows="2"
                            placeholder="Additional details..."></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" (click)="closeAddVehicleModal()">Cancel</button>
                    <button type="submit" class="btn-primary" [disabled]="isSubmitting || vehicleForm.invalid">
                        Save Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card-body">
        <div *ngIf="isLoading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading your vehicles...</p>
        </div>

        <div *ngIf="!isLoading && vehicles.length === 0" class="empty-state">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path
                    d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 17a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4z" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <p>No vehicles added yet.</p>
        </div>

        <div *ngIf="!isLoading && vehicles.length > 0" class="vehicles-grid">
            <div class="vehicle-card" *ngFor="let vehicle of vehicles">
                <div class="vehicle-details-clean">
                    <h4 class="v-model">{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</h4>
                    <div class="v-meta">
                        <span class="v-reg">{{ vehicle.registrationNumber }}</span>
                        <span class="v-divider">|</span>
                        <span class="v-color">{{ vehicle.color }}</span>
                        <span class="v-divider">|</span>
                        <span class="v-type">{{ vehicle.type }}</span>
                    </div>
                </div>
                <div class="vehicle-actions-clean">
                    <button class="btn-book-service" (click)="bookService(vehicle)"
                        [disabled]="hasActiveService(vehicle.id)">
                        {{ hasActiveService(vehicle.id) ? 'In Service' : 'Book Service' }}
                    </button>
                    <button class="btn-delete-clean" (click)="deleteVehicle(vehicle)">
                        Remove
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal-backdrop" *ngIf="dialogVisible" style="z-index: 2000;">
    <div class="modal-content" style="max-width: 400px; padding: 24px;">
        <div class="modal-header" style="margin-bottom: 16px;">
            <h3 style="margin: 0; font-size: 18px;">{{ dialogTitle }}</h3>
        </div>
        <div class="modal-body" style="margin-bottom: 24px;">
            <p [class.text-danger]="dialogType === 'error'" style="margin: 0; color: #374151;">{{ dialogMessage }}</p>
        </div>
        <div class="modal-actions" style="margin-top: 0; padding-top: 0; border: none;">
            <button *ngIf="dialogType === 'confirm'" class="btn-secondary" (click)="closeDialog()">Cancel</button>
            <button *ngIf="dialogType === 'confirm'" class="btn-primary"
                (click)="handleDialogConfirm()">Confirm</button>
            <button *ngIf="dialogType !== 'confirm'" class="btn-primary" (click)="closeDialog()">OK</button>
        </div>
    </div>
</div>